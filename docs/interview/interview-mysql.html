<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-interview/interview-mysql">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">MySQL 篇 | 与你同行-黑铁教程</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://yntx-it.github.io/yntx-black-iron-tutorial-fronted/docs/interview/interview-mysql"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MySQL 篇 | 与你同行-黑铁教程"><meta data-rh="true" name="description" content="什么是事务？事务的四大特性？"><meta data-rh="true" property="og:description" content="什么是事务？事务的四大特性？"><link data-rh="true" rel="icon" href="/yntx-black-iron-tutorial-fronted/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yntx-it.github.io/yntx-black-iron-tutorial-fronted/docs/interview/interview-mysql"><link data-rh="true" rel="alternate" href="https://yntx-it.github.io/yntx-black-iron-tutorial-fronted/docs/interview/interview-mysql" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://yntx-it.github.io/yntx-black-iron-tutorial-fronted/docs/interview/interview-mysql" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/yntx-black-iron-tutorial-fronted/blog/rss.xml" title="与你同行-黑铁教程 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/yntx-black-iron-tutorial-fronted/blog/atom.xml" title="与你同行-黑铁教程 Atom Feed"><link rel="stylesheet" href="/yntx-black-iron-tutorial-fronted/assets/css/styles.39c269dc.css">
<link rel="preload" href="/yntx-black-iron-tutorial-fronted/assets/js/runtime~main.404565d0.js" as="script">
<link rel="preload" href="/yntx-black-iron-tutorial-fronted/assets/js/main.8aeab2d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/yntx-black-iron-tutorial-fronted/"><div class="navbar__logo"><img src="/yntx-black-iron-tutorial-fronted/img/logo.svg" alt="黑铁教程 Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/yntx-black-iron-tutorial-fronted/img/logo.svg" alt="黑铁教程 Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">与你同行-黑铁教程</b></a><a class="navbar__item navbar__link" href="/yntx-black-iron-tutorial-fronted/docs/java">Java教程</a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/yntx-black-iron-tutorial-fronted/docs/interview">面试宝典</a><a class="navbar__item navbar__link" href="/yntx-black-iron-tutorial-fronted/blog">博客</a><a href="https://github.com/yntx-it/yntx-black-iron-tutorial-fronted" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/yntx-black-iron-tutorial-fronted/docs/interview">常见面试题</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-algorithm">算法篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-design">设计模式篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-base">基础篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-collection">集合篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-concurrency">并发篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-jvm">JVM 篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-microservice">微服务篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-mysql">MySQL 篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-redis">Redis 篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-mq">MQ 篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-spring">Spring 篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-mybatis">MyBatis 的原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-other">补充篇</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/yntx-black-iron-tutorial-fronted/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/yntx-black-iron-tutorial-fronted/docs/interview"><span itemprop="name">常见面试题</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MySQL 篇</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>MySQL 篇</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是事务事务的四大特性">什么是事务？事务的四大特性？<a class="hash-link" href="#什么是事务事务的四大特性" title="标题的直接链接">​</a></h2><p>事务是一组操作的集合，它是一个不可分割的工作单位，这些操作要么同时成功，要么同时失败。</p><p>事务的四大特性是：ACID</p><ul><li><p><code>Atomicity 原子性</code>：事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</p><blockquote><p>原子性是通过 undo log （回滚日志）来保证的，因为 undo log 日志记录的是数据修改前的信息。</p><p>比如：</p><p>insert 一条数据，undo log 会记录对应一条 delete 日志。</p><p>update 一条数据时，undo log 会记录之前 旧值 的 update 日志。</p><p>delete 一条数据时，undo log 会记录这条数据的 insert 日志。</p><p>如果执行事务出现了异常情况，就会回滚，利用 undo log 记录数据，来恢复到事务之前的状态。</p></blockquote></li><li><p><code>Consistency 一致性</code>：事务完成时，必须所有的数据保持一致的状态。</p><blockquote><p>一致性是我们使用事务的目的，隔离性、持久性、原子性都是我们保障一致性的手段。</p></blockquote></li><li><p><code>Isolation 隔离性</code>：数据库提供隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</p><blockquote><p>如果多个事务操作同一个数据，那么就会产生脏读、不可重复读、幻读的问题。</p><p>于是，事务与事务之间需要一定的隔离。在 InnoDB 引擎中，定义了四种隔离级别供我们使用。</p></blockquote></li><li><p><code>Durability 持久性</code>：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。</p><blockquote><p>持久性由 redo log （重做日志）来保证，redo log 分为<code>重做日志缓冲</code>和<code>重做日志文件</code>。</p><p>当我们修改数据的时候，MySQL 先把这条记录所在的页找到，然后把该页加载到内存中，将对应记录修改。为了防止内存修改完了，MySQL 就挂掉了，就会写一份 redo log，记录这次在某个页上做了什么修改，即使 MySQL 在中途挂了，我们还可以根据 redo log 进行数据恢复。</p><p>redo log 是顺序写的，写入速度很快。并且它记录的是物理修改，文件的体积很小，恢复速度很快。</p></blockquote></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="事务的隔离级别有哪些">事务的隔离级别有哪些?<a class="hash-link" href="#事务的隔离级别有哪些" title="标题的直接链接">​</a></h2><p>事务的隔离级别：==读未提交==、==读已提交==、==可重复读==和==串行化==，MySQL 默认是==可重复读==。</p><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>Read uncommited 读未提交</td><td>√</td><td>√</td><td>√</td></tr><tr><td>Read committed 读已提交</td><td>×</td><td>√</td><td>√</td></tr><tr><td>Repeatable read 可重复读</td><td>×</td><td>×</td><td>√</td></tr><tr><td>Serializable 串行化</td><td>×</td><td>×</td><td>×</td></tr></tbody></table><ul><li>事务的隔离级别越高，隔离性越好，数据越安全，但是性能越低。</li></ul><p>并发事务问题：==脏读==、==不可重复读==、==幻读==。</p><table><thead><tr><th>问题</th><th align="left">描述</th></tr></thead><tbody><tr><td>脏读</td><td align="left">一个事务读到了另一个事务还没有提交的数据。</td></tr><tr><td>不可重复读</td><td align="left">一个事务先后读取同一条数据，两次数据结果不同。</td></tr><tr><td>幻读</td><td align="left">一个事务按照条件查询数据时，没有对应行，但是在插入数据时，又发现这行数据存在，好像出现了“幻影”。</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内连接与左外连接的区别是什么">内连接与左外连接的区别是什么?<a class="hash-link" href="#内连接与左外连接的区别是什么" title="标题的直接链接">​</a></h2><p>内连接，左表和右表不符合条件的数据都不会在结果中。</p><p>左外连接，不符合条件时，左表的数据会在结果中，这些数据右表的结果为 null。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常用的存储引擎">常用的存储引擎？<a class="hash-link" href="#常用的存储引擎" title="标题的直接链接">​</a></h2><p>常用的存储引擎：==InnoDB==、==MyISAM==、==Memory==。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="innodb-与-myisam-的区别">InnoDB 与 MyISAM 的区别？<a class="hash-link" href="#innodb-与-myisam-的区别" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="innodb">InnoDB<a class="hash-link" href="#innodb" title="标题的直接链接">​</a></h3><ul><li>兼顾高可靠性和高性能的通用存储引擎，在 MySQL5.5 之后默认。</li><li>支持事务。</li><li>支持行级锁，提高并发访问性能。</li><li>支持外键 Foreign key 约束，保证数据的完整性和正确性。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="myisam">MyISAM<a class="hash-link" href="#myisam" title="标题的直接链接">​</a></h3><ul><li>早起的默认存储引擎。</li><li>不支持事务，不支持外键。</li><li>支持表锁，不支持行级锁。</li><li>访问速度快。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="存储引擎的选择">存储引擎的选择<a class="hash-link" href="#存储引擎的选择" title="标题的直接链接">​</a></h3><ul><li>对事务的完整性要求比较高，并发情况下要求数据一致性，数据操作除了插入和查询，还有很多更新、删除操作，选 InnoDB。</li><li>主要是查询和插入操作，很少更新和修改，对事务完整性、并发性要求不高，选 MyISAM。</li><li>将所有数据保存在内存中，临时表，选择 Memory。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="innodb-引擎的索引是什么数据结构">InnoDB 引擎的索引是什么数据结构?<a class="hash-link" href="#innodb-引擎的索引是什么数据结构" title="标题的直接链接">​</a></h2><p>索引：索引是帮助 MySQL 高效获取数据的数据结构。</p><p>InnoDB 引擎的索引是==B+树==索引，是一种==多路搜索树==，所有数据都放在叶子节点，叶子节点形成双向链表。</p><ul><li><p>相对于==二叉树==，每个节点可以存放更多数据，树的高度会比二叉搜索树低，检索速度快。</p></li><li><p>相对于==B 树==，它的非叶子节点不存放数据，在相同数据量情下，B+树更加矮壮。</p></li><li><p>相对于 ==Hash 索引==，B+树支持范围匹配和排序操作。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="索引的分类">索引的分类<a class="hash-link" href="#索引的分类" title="标题的直接链接">​</a></h2><table><thead><tr><th>分类</th><th>含义</th><th>特点</th><th>关键字</th></tr></thead><tbody><tr><td>主键索引</td><td>针对表中主键创建的索引</td><td>默认自动创建，只能有一个</td><td>PRIMARY</td></tr><tr><td>唯一索引</td><td>避免同一个表中某数据列值重复</td><td>可以有多个</td><td>UNIQUE</td></tr><tr><td>常规索引</td><td>快速定位特定数据</td><td>可以有多个</td><td></td></tr><tr><td>全文索引</td><td>全文索引查找的是文本中的关键字，不比较索引的值</td><td>可以有多个</td><td>FULLTEXT</td></tr></tbody></table><p>按存储形式，分两种</p><table><thead><tr><th>分类</th><th>含义</th><th>特点</th></tr></thead><tbody><tr><td>聚集索引</td><td>将数据和索引放到一起，索引结构的叶子节点保存了整行的数据</td><td>必须有，只且有一个</td></tr><tr><td>二级索引</td><td>将数据和索引分开存储，索引结构的叶子节点关联的是对应的主键</td><td>可以有多个</td></tr></tbody></table><blockquote><p>聚集索引选取规则：</p><ul><li>如果存在主键，主键就是聚集索引</li><li>否则，如果存在唯一索引，使用第一个创建的唯一索引作为聚集索引。</li><li>否则，InnoDB 会生成一个 rowid 作为隐藏的聚集索引。</li></ul></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是回表查询">什么是回表查询?<a class="hash-link" href="#什么是回表查询" title="标题的直接链接">​</a></h2><p>回表查询：当我们使用索引查询数据时，查询出来的结果包含非索引字段的其他列，走的索引树叶子节点只能查到当前列值和主键 ID，所以需要根据 ID 再次查询一遍数据，得到 SQL 所有所需的字段列。</p><p>避免回表，可以使用覆盖索引。</p><p>覆盖索引：查的字段都刚好在叶子节点都存在，也就是这些字段都在一个索引里面。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何查看-mysql-的执行计划">如何查看 MySQL 的执行计划?<a class="hash-link" href="#如何查看-mysql-的执行计划" title="标题的直接链接">​</a></h2><p>explain SQL 语句;</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="索引失效的情况有哪些">索引失效的情况有哪些?<a class="hash-link" href="#索引失效的情况有哪些" title="标题的直接链接">​</a></h2><ol><li>联合索引时，没有满足最左前缀法则，查询没有从索引的最左列开始，或者跳过了某列，如果跳过后面的字段将会失效。</li><li>联合索引中使用 &gt;、&lt; 等进行范围查询，范围查询右侧的列失效。</li><li>在索引列上进行运算操作，索引失效。</li><li>在字符串类型使用时不加引号，索引失效。</li><li>头部模糊匹配会导致索引失效。</li><li>or 连接分割的条件，or 前面的列有索引，or 后面的列没有索引，or 前面的索引会失效。</li><li>如果 MySQL 评估使用索引比全表扫描更慢，就不会使用索引。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql-优化">SQL 优化<a class="hash-link" href="#sql-优化" title="标题的直接链接">​</a></h2><ol><li>插入优化：尽量批量插入数据，并且手动控制事务，主键顺序插入。大批量数据插入时用 load data local infile。</li><li>主键优化：主键长度尽量短，顺序自增。</li><li>order by 优化：尽量使用索引，多字段满足最左前缀法则，file sort -&gt; index sort。</li><li>group by 优化：尽量使用索引，多字段满足最左前缀法则。</li><li>limit 优化：分页查询时，尽量使用覆盖索引 + 子查询的方式来优化。通过子查询先查出记录的 ID，再通过 ID 查询需要的数据。</li><li>count 优化：尽量使用 count(<!-- -->*<!-- -->)或 count(1)，而不是 count 字段。</li><li>update 优化：根据主键字段和索引字段进行更新，因为 InnoDB 的行锁都是对索引字段加锁，不这样做会升级为表锁。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="锁">锁<a class="hash-link" href="#锁" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-全局锁">1. 全局锁<a class="hash-link" href="#1-全局锁" title="标题的直接链接">​</a></h3><p>锁住整个数据库实例，一般是做全库备份。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-表级锁">2. 表级锁<a class="hash-link" href="#2-表级锁" title="标题的直接链接">​</a></h3><p>每次操作锁住整张表。锁的粒度大，发生锁冲突的概率高，并发度低。</p><p>表级锁分为 表锁、元数据锁、意向锁。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="表锁">表锁<a class="hash-link" href="#表锁" title="标题的直接链接">​</a></h4><ul><li><p>表共享读锁：不会阻塞读，会阻塞写。lock tables 表名 read/write;</p></li><li><p>表共享写锁：阻塞读又阻塞写。unlock tables 表名，或者客户端断开连接。</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="元数据锁meta-data-lock">元数据锁（meta data lock）<a class="hash-link" href="#元数据锁meta-data-lock" title="标题的直接链接">​</a></h4><p>自动加锁，为了保证元数据的数据一致性，当表上有活动事务时，不允许对元数据写入，避免 DML 与 DDL 冲突。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="意向锁">意向锁<a class="hash-link" href="#意向锁" title="标题的直接链接">​</a></h4><p>避免在 DML 执行时，加的行锁与表锁冲突，引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁减少表锁的检查。</p><ul><li>意向共享锁（IS）：与表锁共享锁兼容，与表锁排它锁互斥。select ... lock in share mode;</li><li>意向排它锁（IX）：与表锁共享锁兼容，与表锁排它锁互斥。insert、update、delete、select ... for update 添加。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3行级锁">3.行级锁<a class="hash-link" href="#3行级锁" title="标题的直接链接">​</a></h3><p>行级锁：每次操作锁住对应行的数据，锁的粒度最小，发生锁冲突的概率最低，并发度最高。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="行锁">行锁<a class="hash-link" href="#行锁" title="标题的直接链接">​</a></h4><p>锁定单个行记录的锁，防止其他事务对此进行 update 和 delete。在 RC、RR 隔离级别都支持。</p><ul><li>共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。</li><li>排他锁（X）：允许获取排他锁的事务更新数据，阻止其他事务获得相同数据集的共享锁和排他锁。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="间隙锁">间隙锁<a class="hash-link" href="#间隙锁" title="标题的直接链接">​</a></h4><p>锁定索引记录间隙，确保索引记录间隙不变，防止其他事务在这个间隙进行 insert，产生幻读。RR 隔离级别支持。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="临键锁">临键锁<a class="hash-link" href="#临键锁" title="标题的直接链接">​</a></h4><p>行锁和间隙锁组合，同事锁住数据，并锁住数据前面的间隙。在 RR 隔离级别下支持。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-mvcc">什么是 MVCC?<a class="hash-link" href="#什么是-mvcc" title="标题的直接链接">​</a></h2><p>当前读：读取的数据是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行枷锁。</p><p>快照读：简单的 select 就是快照读，快照读读取的是数据的可见版本，又可能是历史数据，不加锁，是非阻塞读。</p><ul><li>RC：每次 select 都生成一个快照读。</li><li>RR：每次开启事务第一个 select 语句才是快照读的地方。</li><li>Serializable：快照读会退化为当前读。</li></ul><p>MVCC：多版本并发控制。指维护一个数据的多个版本，使得读写操作没有冲突。快照读提供了一个非阻塞读的功能。具体实现依赖三个隐式字段、undo log 日志、readview。</p><ul><li><p>==隐藏字段==：</p><ul><li>DB_TRX_ID：最近修改事务 ID，记录插入这条记录或者最后一次修改该记录的事务 ID。</li><li>DB_ROLL_PTR：回滚指针，指向这条记录的上一个版本，用于配合 undo log ，指向上一个版本。</li><li>DB_ROW_ID：隐藏主键，如果表结构没有指定主键，将会生成该隐藏字段。</li></ul></li><li><p>==undo log==：回滚日志，在 insert、update、delete 的时候产生便于数据回滚的日志。</p><p>当 insert 的时候，产生的 undo log 只在回滚时需要，在事务提交后，可被立即删除。</p><p>而 update、delete 的时候，产生的 undo log 日志不仅在回滚时需要，在快照读时也需要，不会被立即删除。</p><blockquote><p>undo log 版本链：不同事务或相同事务对同一条记录进行修改，会导致该记录的 undo log 生成一条记录版本链表，链表的头部是最新的旧记录，链表尾部是最早的旧记录。</p></blockquote></li><li><p>==readview==：读视图是 快照读 SQL 执行时 MVCC 提供数据的依据，记录并且维护系统当前活跃事务的 ID。读视图中包含了四个核心字段：</p><ul><li><p>m_ids：当前活跃的事务 ID 集合</p></li><li><p>min_trx_id：最小活跃事务 ID</p></li><li><p>max_trx_id：预分配事务 ID，当前最大事务 ID+1</p></li><li><p>creator_trx_id：readview 创建者的事务 ID</p><blockquote><ul><li><p>trx_id == creator_trx_id ，说明数据是当前事务修改</p></li><li><p>trx_id &lt; min_trx_id ，说明数据已经提交了</p></li><li><p>trx_id &gt; max_trx_id ，不可以访问，说明当前事务是在 raedview 生成后开启</p></li><li><p>min_trx_id &lt;= trx_id &lt;= max_trx_id ， 如果 trx_id 不在 m_ids 中是可以访问该版本的，成立说明数据已提交</p></li></ul><p>readview 生成时机</p><ul><li>RC：事务中每次执行快照读生成 ReadView。</li><li>RR：在事务中第一次执行快照读的时候生成 ReadView，后续复用。</li></ul></blockquote></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="bin-log">bin log<a class="hash-link" href="#bin-log" title="标题的直接链接">​</a></h2><p><code>binlog</code> 用于记录数据库执行的写入性操作(不包括查询)信息，以二进制的形式保存在磁盘中。<code>binlog</code> 是 <code>mysql</code>的逻辑日志，并且由 <code>Server</code> 层进行记录，使用任何存储引擎的 <code>mysql</code> 数据库都会记录 <code>binlog</code> 日志。</p><p>在实际应用中， <code>binlog</code> 的主要使用场景有两个，分别是 <strong>主从复制</strong> 和 <strong>数据恢复</strong> 。</p><ol><li><strong>主从复制</strong> ：在 <code>Master</code> 端开启 <code>binlog</code> ，然后将 <code>binlog</code>发送到各个 <code>Slave</code> 端， <code>Slave</code> 端重放 <code>binlog</code> 从而达到主从数据一致。</li><li><strong>数据恢复</strong> ：通过使用 <code>mysqlbinlog</code> 工具来恢复数据。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="连接池">连接池<a class="hash-link" href="#连接池" title="标题的直接链接">​</a></h2><p>Druid、C3P0、DBCP</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yntx-it/yntx-black-iron-tutorial-fronted/tree/master/shared/docs/interview/interview-mysql.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-microservice"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">微服务篇</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/yntx-black-iron-tutorial-fronted/docs/interview/interview-redis"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Redis 篇</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是事务事务的四大特性" class="table-of-contents__link toc-highlight">什么是事务？事务的四大特性？</a></li><li><a href="#事务的隔离级别有哪些" class="table-of-contents__link toc-highlight">事务的隔离级别有哪些?</a></li><li><a href="#内连接与左外连接的区别是什么" class="table-of-contents__link toc-highlight">内连接与左外连接的区别是什么?</a></li><li><a href="#常用的存储引擎" class="table-of-contents__link toc-highlight">常用的存储引擎？</a></li><li><a href="#innodb-与-myisam-的区别" class="table-of-contents__link toc-highlight">InnoDB 与 MyISAM 的区别？</a><ul><li><a href="#innodb" class="table-of-contents__link toc-highlight">InnoDB</a></li><li><a href="#myisam" class="table-of-contents__link toc-highlight">MyISAM</a></li><li><a href="#存储引擎的选择" class="table-of-contents__link toc-highlight">存储引擎的选择</a></li></ul></li><li><a href="#innodb-引擎的索引是什么数据结构" class="table-of-contents__link toc-highlight">InnoDB 引擎的索引是什么数据结构?</a></li><li><a href="#索引的分类" class="table-of-contents__link toc-highlight">索引的分类</a></li><li><a href="#什么是回表查询" class="table-of-contents__link toc-highlight">什么是回表查询?</a></li><li><a href="#如何查看-mysql-的执行计划" class="table-of-contents__link toc-highlight">如何查看 MySQL 的执行计划?</a></li><li><a href="#索引失效的情况有哪些" class="table-of-contents__link toc-highlight">索引失效的情况有哪些?</a></li><li><a href="#sql-优化" class="table-of-contents__link toc-highlight">SQL 优化</a></li><li><a href="#锁" class="table-of-contents__link toc-highlight">锁</a><ul><li><a href="#1-全局锁" class="table-of-contents__link toc-highlight">1. 全局锁</a></li><li><a href="#2-表级锁" class="table-of-contents__link toc-highlight">2. 表级锁</a></li><li><a href="#3行级锁" class="table-of-contents__link toc-highlight">3.行级锁</a></li></ul></li><li><a href="#什么是-mvcc" class="table-of-contents__link toc-highlight">什么是 MVCC?</a></li><li><a href="#bin-log" class="table-of-contents__link toc-highlight">bin log</a></li><li><a href="#连接池" class="table-of-contents__link toc-highlight">连接池</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/yntx-black-iron-tutorial-fronted/docs/java">Java教程</a></li><li class="footer__item"><a class="footer__link-item" href="/yntx-black-iron-tutorial-fronted/docs/interview">面试宝典</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/yntx-it" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/yntx-it" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/yntx-it" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/yntx-black-iron-tutorial-fronted/blog">本站博客</a></li><li class="footer__item"><a href="https://github.com/yntx-it" target="_blank" rel="noopener noreferrer" class="footer__link-item">与你同行GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/yntx-org" target="_blank" rel="noopener noreferrer" class="footer__link-item">与你同行Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 与你同行技术, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/yntx-black-iron-tutorial-fronted/assets/js/runtime~main.404565d0.js"></script>
<script src="/yntx-black-iron-tutorial-fronted/assets/js/main.8aeab2d5.js"></script>
</body>
</html>